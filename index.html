<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>TIMER</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- PrimeIcons (součást ekosystému PrimeNG) -->
    <link rel="stylesheet" href="https://unpkg.com/primeicons/primeicons.css">

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top, #1f2933, #020617);
            color: #f9fafb;
            min-height: 100vh;
            display: flex;
            align-items: stretch;
            justify-content: center;
        }

        .app {
            max-width: 960px;
            margin: 0 auto;
            padding: 24px 16px 32px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            width: 100%;
        }

        header { text-align: center; }

        header h1 {
            font-size: clamp(1.4rem, 2.3vw, 1.9rem);
            font-weight: 600;
            margin-bottom: 10px;
            color: #e5e7eb;
        }

        .note-display {
            min-height: 2.4em;
            font-size: clamp(1.1rem, 2vw, 1.4rem);
            color: #f9fafb;
            font-weight: 500;
        }

        .note-display.placeholder {
            color: #9ca3af;
            font-style: italic;
            font-weight: 400;
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 24px;
            align-items: center;
            justify-content: center;
        }

        #timer {
            font-size: clamp(4rem, 20vw, 9rem);
            font-weight: 700;
            text-align: center;
            letter-spacing: 0.08em;
            text-shadow: 0 0 20px rgba(15,23,42,0.9);
        }

        #timer.finished {
            color: #f97316;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        .end-time {
            color: #9ca3af;
            margin-top: 8px;
            font-size: clamp(1.1rem, 1.6vw, 1.3rem);
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
        }

        button {
            border: none;
            border-radius: 9999px;
            padding: 8px 18px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: 0.12s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        button:disabled { opacity: 0.6; cursor: not-allowed; }

        #newCountdownBtn { background: #2563eb; color: white; }
        #startStopBtn { background: #16a34a; color: white; }
        #startStopBtn.running { background: #ea580c; }
        #noteBtn, #resetBtn, #fullscreenBtn {
            background: #111827;
            color: #e5e7eb;
            border: 1px solid #374151;
        }

        footer {
            text-align: center;
            color: #6b7280;
            margin-top: auto;
            font-size: 0.8rem;
        }

        /* === MODÁLY === */

        .modal-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(15,23,42,0.7);
            z-index: 50;
        }

        .modal {
            background: #020617;
            border: 1px solid #1f2937;
            border-radius: 16px;
            padding: 20px;
            width: min(420px, 92vw);
        }

        /* trochu větší mezera pod nadpisem */
        .modal h2 {
            margin-bottom: 14px;
            font-size: 1.1rem;
        }

        .modal label {
            font-size: 0.95rem;
            color: #e5e7eb;
            display: block;
            margin-bottom: 6px; /* mezera mezi textem labelu a inputem */
        }

        .modal input,
        .modal textarea {
            width: 100%;
            padding: 8px 10px;
            margin-top: 0;           /* už řídíme mezeru label/input jinak */
            margin-bottom: 16px;
            background: #020617;
            border-radius: 10px;
            border: 1px solid #4b5563;
            color: white;
            font-size: 0.95rem;
        }

        .modal textarea {
            min-height: 80px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 14px;  /* mezera mezi inputem a tlačítky dole */
        }

        .btn-secondary { background: #111827; color:white; border:1px solid #4b5563; }
        .btn-primary   { background:#3b82f6;color:white; }

        .hidden { display:none; }

        /* === PRIME-NG STYLE INPUT S VLASTNÍMI ŠIPKAMI === */

        /* wrapper kolem inputu + šipek */
        .input-with-icon {
            display: flex;
            align-items: stretch;
            width: 100%;
            border-radius: 10px;
            border: 1px solid #4b5563;
            background: #020617;
            overflow: hidden;
            margin-top: 4px;     /* malý odstup od labelu */
        }

        .input-with-icon input {
            flex: 1;
            border: none;
            background: transparent;
            color: #f9fafb;
            padding: 8px 10px;
            font-size: 0.95rem;
        }

        .input-with-icon input:focus {
            outline: none;
        }

        /* schování nativních šipek, protože máme vlastní */
        .input-with-icon input[type="number"]::-webkit-outer-spin-button,
        .input-with-icon input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .input-with-icon input[type="number"] {
            -moz-appearance: textfield; /* Firefox */
        }

        .spinner-buttons {
            display: flex;
            flex-direction: column;
            border-left: 1px solid #374151;
        }

        .spinner-btn {
            border-radius: 0;
            padding: 0;
            width: 24px;
            height: 50%;
            background: #020617;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.12s, color 0.12s;
        }

        .spinner-btn i {
            font-size: 0.7rem;
            color: #9ca3af;
        }

        .spinner-btn:hover {
            background: #111827;
        }

        .spinner-btn:hover i {
            color: #e5e7eb;
        }

        .spinner-btn:active {
            background: #1f2937;
        }

        @media (max-width: 600px) {
            button { font-size:0.85rem; padding:7px 14px; }
        }
    </style>
</head>

<body>
<div class="app">
    <header>
        <h1>Timer</h1>
        <div id="noteDisplay" class="note-display placeholder">
            Přidej si poznámku (např. „Přestávka“) tlačítkem níže.
        </div>
    </header>

    <main>
        <div class="timer-display"><span id="timer">00:00</span></div>
        <div class="end-time"><span id="endTimeLabel">Konec v: <strong>--:--</strong></span></div>

        <div class="controls">
            <button id="newCountdownBtn">Nový odpočet</button>
            <button id="startStopBtn" disabled>Start</button>
            <button id="resetBtn" disabled>Reset</button>
            <button id="noteBtn">Poznámka</button>
            <button id="fullscreenBtn">Celá obrazovka</button>
        </div>

        <div id="statusMessage" class="status-message"></div>
    </main>

    <footer>Jednoduchá časomíra – HTML / CSS / JS</footer>

    <!-- MODÁL: ODPOČET -->
    <div id="countdownModal" class="modal-overlay hidden">
        <div class="modal">
            <h2>Nastavit odpočet</h2>
            <label for="minutesInput">Počet minut (1–600):</label>

            <div class="input-with-icon">
                <input
                    type="number"
                    id="minutesInput"
                    min="1"
                    max="600"
                    placeholder="Zadejte počet minut">
                <div class="spinner-buttons">
                    <button type="button" class="spinner-btn spinner-up">
                        <i class="pi pi-chevron-up"></i>
                    </button>
                    <button type="button" class="spinner-btn spinner-down">
                        <i class="pi pi-chevron-down"></i>
                    </button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-secondary" data-close-modal="countdownModal">Zrušit</button>
                <button class="btn-primary" id="saveCountdownBtn">Uložit</button>
            </div>
        </div>
    </div>

    <!-- MODÁL: POZNÁMKA -->
    <div id="noteModal" class="modal-overlay hidden">
        <div class="modal">
            <h2>Nastavit poznámku</h2>
            <label for="noteInput">Text poznámky:</label>
            <textarea id="noteInput" placeholder="Přestávka"></textarea>
            <div class="modal-actions">
                <button class="btn-secondary" data-close-modal="noteModal">Zrušit</button>
                <button class="btn-primary" id="saveNoteBtn">Uložit</button>
            </div>
        </div>
    </div>
</div>

<script>
/* ===== LOGIKA A OVLÁDÁNÍ ===== */

let initialDurationMs = 0;
let remainingMs = 0;
let timerInterval = null;
let isRunning = false;
let endTime = null;

const timerEl = document.getElementById('timer');
const endTimeLabelEl = document.getElementById('endTimeLabel');
const statusMessageEl = document.getElementById('statusMessage');
const noteDisplayEl = document.getElementById('noteDisplay');

const newCountdownBtn = document.getElementById('newCountdownBtn');
const startStopBtn = document.getElementById('startStopBtn');
const resetBtn = document.getElementById('resetBtn');
const noteBtn = document.getElementById('noteBtn');
const fullscreenBtn = document.getElementById('fullscreenBtn');

const countdownModal = document.getElementById('countdownModal');
const minutesInput = document.getElementById('minutesInput');
const saveCountdownBtn = document.getElementById('saveCountdownBtn');

const noteModal = document.getElementById('noteModal');
const noteInput = document.getElementById('noteInput');
const saveNoteBtn = document.getElementById('saveNoteBtn');

// Šipky (PrimeIcons spinner) – PrimeNG-like chování
const spinnerUp = document.querySelector('.spinner-up');
const spinnerDown = document.querySelector('.spinner-down');

function clampMinutes(value) {
    if (isNaN(value)) value = 0;
    if (value < 1) return 1;
    if (value > 600) return 600;
    return value;
}

function adjustMinutes(delta) {
    let current = parseInt(minutesInput.value, 10);
    if (isNaN(current)) current = 0;
    const next = clampMinutes(current + delta);
    minutesInput.value = next;
}

if (spinnerUp) {
    spinnerUp.addEventListener('click', () => adjustMinutes(1));
}
if (spinnerDown) {
    spinnerDown.addEventListener('click', () => adjustMinutes(-1));
}

function formatTime(ms) {
    const total = Math.max(0, Math.floor(ms/1000));
    const m = String(Math.floor(total/60)).padStart(2,'0');
    const s = String(total%60).padStart(2,'0');
    return m+":"+s;
}

function formatClock(date) {
    if (!date) return "--:--";
    return String(date.getHours()).padStart(2,'0') + ":" + String(date.getMinutes()).padStart(2,'0');
}

function updateTimer() { timerEl.textContent = formatTime(remainingMs); }
function updateEndTime() { endTimeLabelEl.innerHTML = "Konec v: <strong>" + formatClock(endTime) + "</strong>"; }
function setStatus(t) { statusMessageEl.textContent = t || ""; }

function openModal(modal) { modal.classList.remove("hidden"); }
function closeModal(modal) { modal.classList.add("hidden"); }

[countdownModal, noteModal].forEach(m=>{
    m.addEventListener("click", e=>{
        if(e.target===m) closeModal(m);
    });
});

document.querySelectorAll("[data-close-modal]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
        closeModal(document.getElementById(btn.dataset.closeModal));
    });
});

function startTimer() {
    if (initialDurationMs <= 0) return setStatus("Nejprve nastav odpočet.");
    if (remainingMs <= 0) remainingMs = initialDurationMs;

    endTime = new Date(Date.now() + remainingMs);
    updateEndTime();

    isRunning = true;
    startStopBtn.textContent = "Stop";
    startStopBtn.classList.add("running");

    if (timerInterval) clearInterval(timerInterval);

    timerInterval = setInterval(()=>{
        remainingMs = endTime - Date.now();
        if (remainingMs <= 0) {
            remainingMs = 0;
            updateTimer();
            clearInterval(timerInterval);
            timerInterval=null;
            isRunning=false;
            startStopBtn.textContent="Start";
            startStopBtn.classList.remove("running");
            timerEl.classList.add("finished");
            setStatus("Čas vypršel.");
        } else {
            updateTimer();
        }
    },200);

    updateTimer();
}

function stopTimer() {
    if (!isRunning) return;
    isRunning=false;
    clearInterval(timerInterval);
    timerInterval=null;
    remainingMs = Math.max(0,endTime - Date.now());
    startStopBtn.textContent="Start";
    startStopBtn.classList.remove("running");
    setStatus("Odpočet pozastaven.");
    updateTimer();
}

function resetTimer() {
    if (!initialDurationMs) return;
    clearInterval(timerInterval);
    timerInterval=null;
    remainingMs = initialDurationMs;
    endTime=null;
    isRunning=false;
    startStopBtn.textContent="Start";
    startStopBtn.classList.remove("running");
    timerEl.classList.remove("finished");
    updateTimer();
    updateEndTime();
    setStatus("Odpočet resetován.");
}

newCountdownBtn.addEventListener("click", ()=>{
    minutesInput.value="";
    openModal(countdownModal);
    minutesInput.focus();
});

saveCountdownBtn.addEventListener("click", ()=>{
    const minutes = parseInt(minutesInput.value,10);
    if (isNaN(minutes) || minutes<1 || minutes>600)
        return setStatus("Zadej prosím počet minut mezi 1 a 600.");

    initialDurationMs = minutes*60000;
    remainingMs = initialDurationMs;
    clearInterval(timerInterval);
    timerInterval=null;
    isRunning=false;
    endTime=null;

    updateTimer();
    updateEndTime();
    setStatus("Odpočet nastaven na "+minutes+" minut.");

    startStopBtn.disabled=false;
    resetBtn.disabled=false;

    closeModal(countdownModal);
});

startStopBtn.addEventListener("click", ()=>{
    isRunning ? stopTimer() : startTimer();
});

resetBtn.addEventListener("click", resetTimer);

noteBtn.addEventListener("click", ()=>{
    noteInput.value = noteDisplayEl.classList.contains("placeholder") ? "" : noteDisplayEl.textContent;
    openModal(noteModal);
    noteInput.focus();
});

saveNoteBtn.addEventListener("click", ()=>{
    const t = noteInput.value.trim();
    if (!t) {
        noteDisplayEl.textContent="Přidej si poznámku (např. „Přestávka“) tlačítkem níže.";
        noteDisplayEl.classList.add("placeholder");
    } else {
        noteDisplayEl.textContent=t;
        noteDisplayEl.classList.remove("placeholder");
    }
    closeModal(noteModal);
});

fullscreenBtn.addEventListener("click", ()=>{
    !document.fullscreenElement
        ? document.documentElement.requestFullscreen()
        : document.exitFullscreen();
});

document.addEventListener("fullscreenchange", ()=>{
    fullscreenBtn.textContent = document.fullscreenElement ? "Ukončit celou obrazovku" : "Celá obrazovka";
});

updateTimer();
updateEndTime();
setStatus("Nastav odpočet tlačítkem „Nový odpočet“.");
</script>
</body>
</html>
